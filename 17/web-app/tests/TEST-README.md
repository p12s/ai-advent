# Тесты для docker-report.js

Этот файл содержит полный набор тестов для модуля `docker-report.js`, который отвечает за создание и развертывание HTML отчетов в Docker контейнерах.

## Структура тестов

### 1. parseGitHubDataFromReport
Тестирует функцию парсинга GitHub данных из markdown отчета:
- Корректный парсинг валидного отчета
- Обработка пустых отчетов
- Парсинг репозиториев с разными форматами имен
- Обработка ошибок парсинга

### 2. createHtmlReport
Тестирует функцию создания HTML отчетов:
- Создание отчета для валидных данных
- Обработка пустых данных
- Отображение предупреждений при наличии неразрешенных задач
- Отображение успешного статуса
- Обработка репозиториев с ошибками

### 3. DockerReportManager
Тестирует класс управления Docker контейнерами:
- Создание конфигурации контейнера
- Генерация случайных портов
- Кодирование HTML контента
- HTTP запросы к Docker API
- Развертывание HTML отчетов
- Проверка здоровья сервиса

### 4. Интеграционные тесты
Тестирует полный цикл работы модуля от парсинга данных до создания отчета.

## Установка и запуск

### Установка зависимостей
```bash
npm install
```

### Запуск тестов
```bash
# Запуск всех тестов
npm test

# Запуск тестов в режиме наблюдения
npm run test:watch

# Запуск тестов с отчетом о покрытии
npm run test:coverage
```

## Конфигурация

### Jest настройки
- **testEnvironment**: jsdom - для эмуляции браузерного окружения
- **setupFilesAfterEnv**: jest.setup.js - настройки перед запуском тестов
- **collectCoverageFrom**: docker-report.js - файл для анализа покрытия
- **coverageReporters**: text, lcov, html - форматы отчетов о покрытии

### Моки
- `fetch` - для тестирования HTTP запросов
- `console` - для перехвата логов
- `window`, `document` - браузерные объекты
- `Date`, `Math.random` - для предсказуемых тестов

## Структура файлов

```
web-app/
├── docker-report.js          # Основной модуль
├── docker-report.test.js     # Тесты
├── test-utils.js            # Утилиты для тестирования
├── jest.setup.js            # Настройки Jest
├── package.json             # Конфигурация npm
└── TEST-README.md           # Этот файл
```

## Примеры использования

### Запуск конкретного теста
```bash
npm test -- --testNamePattern="должен корректно парсить валидный markdown отчет"
```

### Запуск тестов с подробным выводом
```bash
npm test -- --verbose
```

### Просмотр отчета о покрытии
После запуска `npm run test:coverage` откройте файл `coverage/lcov-report/index.html` в браузере.

## Добавление новых тестов

1. Добавьте новый `describe` блок в `docker-report.test.js`
2. Используйте `test()` или `it()` для отдельных тестов
3. Используйте `beforeEach()` для настройки перед каждым тестом
4. Используйте `jest.fn()` для создания моков
5. Используйте `expect()` для проверок

### Пример нового теста
```javascript
describe('Новая функция', () => {
    test('должен корректно обрабатывать валидные данные', () => {
        const result = newFunction('test');
        expect(result).toBe('expected');
    });
});
```

## Отладка тестов

### Включение отладочного вывода
```bash
npm test -- --verbose --detectOpenHandles
```

### Запуск одного теста
```bash
npm test -- --testNamePattern="название теста"
```

### Просмотр моков
```javascript
console.log(fetch.mock.calls);
console.log(console.log.mock.calls);
```

## Лучшие практики

1. **Изоляция тестов**: Каждый тест должен быть независимым
2. **Очистка моков**: Используйте `beforeEach()` для очистки состояния
3. **Описательные имена**: Называйте тесты так, чтобы было понятно что они проверяют
4. **Покрытие кода**: Стремитесь к 100% покрытию кода тестами
5. **Моки**: Мокайте внешние зависимости для изоляции тестов

## Проблемы и решения

### Ошибка "Cannot find module"
Убедитесь, что все зависимости установлены:
```bash
npm install
```

### Ошибка "fetch is not defined"
Проверьте, что `jest.setup.js` правильно настроен и подключен в `package.json`.

### Тесты падают из-за асинхронности
Используйте `async/await` или `done()` callback для асинхронных тестов.

### Проблемы с моками
Убедитесь, что моки создаются в `beforeEach()` и очищаются после каждого теста.
